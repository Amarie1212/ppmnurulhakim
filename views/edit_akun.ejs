<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title><%= title %></title>
  <link rel="icon" type="image/png" href="/img/logo ppm.png" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="/styles.css"/>
  <link rel="stylesheet" href="/form.css"/>
  <link rel="stylesheet" href="/duty.css"/>
  <style>
    .brand-wrap { display: flex; align-items: center; gap: 12px; }
    
    .form-wrap {
      width: min(980px, 94%); 
      margin: calc(var(--nav-h) + 32px) auto 64px; 
    }
    
    .actions { 
      display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; 
    }
    
    @media (max-width: 640px) {
      .actions { flex-direction: column-reverse; }
      .actions .btn-ghost, .actions .btn-nav { width: 100%; justify-content: center; padding: 14px; }
      .form-title { font-size: 1.5rem; }
    }
  </style>
</head>
<body class="form-page layout-form">

<header class="navbar">
  <div class="container nav-inner">
    <div class="brand-wrap">
      <a href="/" class="btn-back-inline" aria-label="Kembali ke Beranda" title="Kembali ke Beranda">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
      </a>
      <div class="brand">Edit Data Akun</div>
    </div>
  </div>
</header>

<main class="form-wrap">
  <div class="form-card">
    
    <% if (user.status === 'REJECTED') { %>
      <div style="text-align:center; margin-bottom:24px;">
         <span style="display:inline-block; color:#ef4444; font-weight:600; font-size:1rem; padding:8px 16px; border-radius:100px; background:rgba(239,68,68,0.08);">
            Perbaiki: "<%= user.alasan_tolak || 'Data akun tidak valid' %>"
         </span>
      </div>
    <% } else { %>
      <p class="lead" style="text-align:center; margin-bottom:20px; font-size:0.95rem; line-height:1.6; color:var(--muted);">
        Halo, <strong style="color:var(--text)"><%= user.name %></strong>!<br>
        <span>Silakan edit data akun Anda di bawah ini.</span>
      </p>
    <% } %>

    <% if (typeof error !== 'undefined' && error) { %>
      <div style="background:rgba(239,68,68,0.1); border:1px solid rgba(239,68,68,0.3); color:#ef4444; padding:14px; border-radius:12px; margin-bottom:24px; text-align:center; font-weight:600;">
        ⚠️ <%= error %>
      </div>
    <% } %>

    <form action="/edit-akun" method="POST">
      <div class="grid-12">
        <div class="col-12"><label class="label">Nama Lengkap <span style="color:var(--danger)">*</span></label><input class="input" name="nama" value="<%= akun.nama || '' %>" required></div>
        <div class="col-12"><label class="label">Email</label><input type="email" class="input" value="<%= akun.email || '' %>" readonly style="opacity:0.7; cursor:default;"></div>
        <div class="col-6"><label class="label">No WhatsApp <span style="color:var(--danger)">*</span></label><input class="input" name="wa" value="<%= akun.wa || '' %>" placeholder="08..." required></div>
        <div class="col-6"></div>

        <div class="col-12"><div class="divider"></div></div>
        
        <div class="col-4"><label class="label">Asal Kelompok <span style="color:var(--danger)">*</span></label><input class="input" name="kelompok" value="<%= akun.kelompok || '' %>" required></div>
        <div class="col-4"><label class="label">Asal Desa <span style="color:var(--danger)">*</span></label><input class="input" name="desa" value="<%= akun.desa || '' %>" required></div>
        <div class="col-4"><label class="label">Asal Daerah <span style="color:var(--danger)">*</span></label><input class="input" name="daerah" value="<%= akun.daerah || '' %>" required></div>

        <div class="col-6"><label class="label">Kampus <span style="color:var(--danger)">*</span></label><input class="input" name="kampus" value="<%= akun.kampus || '' %>" required></div>
        <div class="col-6"><label class="label">Prodi / Jurusan <span style="color:var(--danger)">*</span></label><input class="input" name="prodi" value="<%= akun.prodi || '' %>" required></div>

        <div class="col-12 actions">
          <a href="/" class="btn-ghost">Batal</a>
          <button class="btn-nav" type="submit">Simpan & Kirim Ulang</button>
        </div>
      </div>
    </form>
  </div>
</main>

<button id="themeFab" class="theme-fab" aria-label="Ganti tema" title="Ganti tema"></button>

<footer class="footer">
  <div class="container"><p>© <%= new Date().getFullYear() %> PPM Nurul Hakim Jatinangor</p></div>
</footer>

<script>
  const root=document.documentElement;
  function setFabIcon(theme){
    const sun='<svg class="icon" viewBox="0 0 24 24"><path d="M6.76 4.84l-1.8-1.79L3.5 4.5l1.79 1.79 1.47-1.45zM1 13h3v-2H1v2zm10-9h2V1h-2v3zm7.24.84L18.5 4.5l-1.46 1.47 1.79 1.79 1.41-1.41zM20 13h3v-2h-3v2zm-7 7h2v-3h-2v3zm5.74-2.16l1.79 1.79 1.41-1.41-1.79-1.79-1.41 1.41zM4.5 18.5l1.79-1.79-1.41-1.41-1.79 1.79 1.41 1.41zM12 6a6 6 0 1 1 0 12 6 6 0 0 1 0-12z"></path></svg>';
    const moon='<svg class="icon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>';
    const fab=document.getElementById('themeFab'); if(fab) fab.innerHTML=(theme==='light')?moon:sun;
  }
  function applyTheme(theme){
    if(theme==='light') root.setAttribute('data-theme','light'); else root.removeAttribute('data-theme');
    localStorage.setItem('theme',theme); setFabIcon(theme);
    const fab=document.getElementById('themeFab'); if(fab){ fab.classList.add('spin'); setTimeout(()=>fab.classList.remove('spin'),400); }
  }
  (function initTheme(){
    const saved=localStorage.getItem('theme');
    if(saved) applyTheme(saved); else {
      const prefersLight=window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      applyTheme(prefersLight?'light':'dark');
    }
    document.getElementById('themeFab')?.addEventListener('click',()=>{
      const isLight=root.getAttribute('data-theme')==='light';
      applyTheme(isLight?'dark':'light');
    });
  })();
</script>
</body>
</html>
